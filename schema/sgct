{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "https://sgct.github.io/schema/sgct",

  "type": "object",
  "properties": {
    "capture": { "$ref": "#/$defs/capture" },
    "debuglog": { "type": "boolean" },
    "externalcontrolport": { "type": "integer", "minimum": 0 },
    "firmsync": { "type": "boolean" },
    "masteraddress": { "type": [ "number", "string" ] },
    "nodes": {
      "type": "array",
      "items": { "$ref": "#/$defs/node" }
    },
    "scene": { "$ref": "#/$defs/scene" },
    "settings": { "$ref": "#/$defs/settings" },
    "threadaffinity": { "type": "integer", "minimum": 0 },
    "trackers": {
      "type": "array",
      "items": {"$ref": "#/$defs/tracker" }
    },
    "version": { "type": "integer" },
    "users": {
      "type": "array",
      "items": { "$ref": "#/$defs/user" }
    }
  },
  "required": [
    "version", "masteraddress"
  ],


  "$defs": {
    "quat": {
      "type": "object",
      "anyOf": [
        {
          "properties": {
            "pitch": { "type": "number" },
            "yaw": { "type": "number" },
            "roll": { "type": "number" }
          },
          "required": [ "pitch", "yaw", "roll" ]
        },
        {
          "properties": {
            "x": { "type": "number" },
            "y": { "type": "number" },
            "z": { "type": "number" },
            "w": { "type": "number" }
          },
          "required": [ "x", "y", "z", "w" ]
        }
      ]
    },
    "mat4": {
      "type": "array",
      "items": { "type": "number" },
      "minItems": 16,
      "maxItems": 16
    },
    "ivec2": {
      "type": "object",
      "properties": {
        "x": { "type": "integer" },
        "y": { "type": "integer" }
      },
      "required": [ "x", "y" ],
      "additionalProperties": false
    },
    "vec2": {
      "type": "object",
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" }
      },
      "required": [ "x", "y" ],
      "additionalProperties": false
    },
    "vec3": {
      "type": "object",
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" },
        "z": { "type": "number" }
      },
      "required": [ "x", "y", "z" ],
      "additionalProperties": false
    },
    "color": {
      "type": "object",
      "properties": {
        "r": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "g": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "b": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "a": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        }
      },
      "required": [ "r", "g", "b", "a" ]
    },

    "quality": {
      "type": "string",
      "enum": [
        "low", "256", "medium", "512", "high", "1k", "1024", "1.5k", "1536", "2k", "2048",
        "4k", "4096", "8k", "8192", "16k", "16384", "32k", "32768", "64k", "65536"
      ]
    },

    "planarprojection": {
      "type": "object",
      "properties": {
        "type": { "const": "PlanarProjection" },
        "fov": {
          "type": "object",
          "allOf": [
            {
              "anyOf": [
                {
                  "hfov": {
                    "type": "number",
                    "minimum": 0.0
                  }
                },
                {
                  "left": {
                    "type": "number"
                  },
                  "right": {
                    "type": "number"
                  }
                }
              ]
            },
            {
              "anyOf": [
                {
                  "vfov": {
                    "type": "number",
                    "minimum": 0.0
                  }
                },
                {
                  "down": {
                    "type": "number"
                  },
                  "up": {
                    "type": "number"
                  }
                }
              ]
            }
          ]
        },
        "distance": {
          "type": "number"
        },
        "orientation": { "$ref": "#/$defs/quat" },
        "offset": { "$ref": "#/$defs/vec3" }
      }
    },

    "fisheyeprojection": {
      "type": "object",
      "properties": {
        "type": { "const": "FisheyeProjection" },
        "fov": { "type": "number", "minimum": 0.0 },
        "quality": { "$ref": "#/$defs/quality" },
        "interpolation": {
          "type": "string",
          "enum": [ "cubic", "linear" ]
        },
        "diameter": {
          "type": "number"
        },
        "tilt": {
          "type": "number"
        },
        "crop": {
          "type": "object",
          "properties": {
            "left": { "type": "number" },
            "right": { "type": "number" },
            "bottom": { "type": "number" },
            "top": { "type": "number" }
          }
        },
        "keepaspectratio": { "type": "boolean" },
        "offset": { "$ref": "#/$defs/vec3" },
        "background": { "$ref": "#/$defs/color" }
      },
      "required": [ "type" ]
    },

    "sphericalmirrorprojection": {
      "type": "object",
      "properties": {
        "type": { "const": "SphericalMirrorProjection" },
        "quality": { "$ref": "#/$defs/quality" },
        "tilt": { "type": "number" },
        "background": { "$ref": "#/$defs/color" },
        "geometry": {
          "type": "object",
          "properties": {
            "bottom": { "type": "string" },
            "left": { "type": "string" },
            "right": { "type": "string" },
            "top": { "type": "string" }
          }
        }
      },
      "required": [ "type" ]
    },

    "spoutoutputprojection": {
      "type": "object",
      "properties": {
        "type": { "const": "SpoutOutputProjection" },
        "quality": { "$ref": "#/$defs/quality" },
        "mapping": {
          "type": "string",
          "enum": [ "fisheye", "equirectangular", "cubemap" ]
        },
        "mappingspoutname": { "type": "string" },
        "background": { "$ref": "#/$defs/color" },
        "channels": {
          "type": "object",
          "properties": {
            "right": { "type": "boolean" },
            "zleft": { "type": "boolean" },
            "bottom": { "type": "boolean" },
            "top": { "type": "boolean" },
            "left": { "type": "boolean" },
            "zright": { "type": "boolean" }
          },
          "required": [ "right", "zleft", "bottom", "top", "left", "zright" ]
        },
        "orientation": {
          "type": "object",
          "properties": {
            "pitch": { "type": "number" },
            "yaw": { "type": "number" },
            "roll": { "type": "number" }
          },
          "required": [ "pitch", "yaw", "roll" ]
        }
      },
      "required": [ "type" ],
      "additionalProperties": false
    },

    "cylindricalprojection": {
      "type": "object",
      "properties": {
        "type": { "const": "CylindricalProjection" },
        "quality": { "$ref": "#/$defs/quality" },
        "rotation": {
          "type": "number"
        },
        "heightOffset": {
          "type": "number"
        },
        "radius": {
          "type": "number"
        }
      },
      "required": [ "type" ],
      "additionalProperties": false
    },

    "equirectangularprojection": {
      "type": "object",
      "properties": {
        "type": { "const": "EquirectangularProjection" },
        "quality": { "$ref": "#/$defs/quality" }
      },
      "required": [ "type" ],
      "additionalProperties": false
    },

    "projectionplane": {
      "type": "object",
      "properties": {
        "type": { "const": "ProjectionPlane" },
        "lowerleft": { "$ref": "#/$defs/vec3" },
        "upperleft": { "$ref": "#/$defs/vec3" },
        "upperright": { "$ref": "#/$defs/vec3" }
      },
      "required": [ "type", "lowerleft", "upperleft", "upperright" ],
      "additionalProperties": false
    },


    "projection": {
      "type": "object",
      "allOf": [
        {
          "if": {
            "properties": { "type": { "const": "PlanarProjection" } },
            "required": [ "type" ]
          },
          "then": {
            "$ref": "#/$defs/planarprojection"
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "FisheyeProjection" } },
            "required": [ "type" ]
          },
          "then": {
            "$ref": "#/$defs/fisheyeprojection"
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "SphericalMirrorProjection" } },
            "required": [ "type" ]
          },
          "then": {
            "$ref": "#/$defs/sphericalmirrorprojection"
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "SpoutOutputProjection" } },
            "required": [ "type" ]
          },
          "then": {
            "$ref": "#/$defs/spoutoutputprojection"
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "CylindricalProjection" } },
            "required": [ "type" ]
          },
          "then": {
            "$ref": "#/$defs/cylindricalprojection"
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "EquirectangularProjection" } },
            "required": [ "type" ]
          },
          "then": {
            "$ref": "#/$defs/equirectangularprojection"
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "ProjectionPlane" } },
            "required": [ "type" ]
          },
          "then": {
            "$ref": "#/$defs/projectionplane"
          }
        }
      ]
    },

    "viewport": {
      "type": "object",
      "properties": {
        "user": { "type": "string"},
        "overlay": { "type": "string"},
        "blendmask": { "type": "string"},
        "blacklevelmask": { "type": "string"},
        "mesh": { "type": "string"},
        "tracked": { "type": "boolean" },
        "eye": {
          "type": "string",
          "enum": [ "center", "left", "right" ]
        },
        "pos": { "$ref": "#/$defs/vec2" },
        "size": { "$ref": "#/$defs/vec2" },
        "projection": { "$ref": "#/$defs/projection"}
      }
    },

    "window": {
      "type": "object",
      "properties": {
        "id": {
          "type": "integer"
        },
        "name": {
          "type": "string"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "bufferbitdepth": {
          "type": "string",
          "enum": [ "8", "16", "16f", "32f", "16i", "32i", "16ui", "32ui" ]
        },
        "fullscreen": { "type": "boolean" },
        "autoiconify": { "type": "boolean" },
        "hidemousecursor": { "type": "boolean" },
        "floating": { "type": "boolean" },
        "alwaysrender": { "type": "boolean" },
        "hidden": { "type": "boolean" },
        "doublebuffered": { "type": "boolean" },
        "msaa": {
          "type": "integer",
          "minimum": 0
        },
        "alpha": { "type": "boolean" },
        "fxaa": { "type": "boolean" },
        "border": { "type": "boolean" },
        "mirror": { "type": "boolean" },
        "draw2d": { "type": "boolean" },
        "draw3d": { "type": "boolean" },
        "blitwindowid": { "type": "integer" },
        "monitor": { "type": "integer" },
        "mpcdi": { "type": "string" },
        "stereo": {
          "type": "string",
          "enum": [
            "none", "no_stereo",
            "active", "quadbuffer",
            "checkerboard",
            "checkerboard_inverted",
            "anaglyph_red_cyan",
            "anaglyph_amber_blue",
            "anaglyph_wimmer",
            "vertical_interlaced",
            "vertical_interlaced_inverted",
            "test", "dummy",
            "side_by_side",
            "side_by_side_inverted",
            "top_bottom",
            "top_bottom_inverted"
          ]
        },
        "pos": { "$ref": "#/$defs/ivec2" },
        "size": { "$ref": "#/$defs/ivec2" },
        "res": { "$ref": "#/$defs/ivec2" },
        "viewports": {
          "type": "array",
          "items": { "$ref": "#/$defs/viewport" }
        }
      }
    },

    "node": {
      "type": "object",
      "properties": {
        "address": { "type": [ "number", "string" ] },
        "port": { "type": "integer", "minimum": 0 },
        "datatransferport": { "type": "integer", "minimum": 0 },
        "swaplock": { "type": "boolean" },
        "windows": {
          "type": "array",
          "items": { "$ref": "#/$defs/window" }
        }
      },
      "required": [ "address", "port" ]
    },
    
    "user": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "eyeseparation": {
          "type": "number",
          "minimum": 0.0
        },
        "pos": { "$ref": "#/$defs/vec3" },
        "matrix": { "$ref": "#/$defs/mat4" },
        "orientation": { "$ref": "#/$defs/quat" },
        "tracking": {
          "type": "array",
          "items": { 
            "type": "object",
            "properties": {
              "tracker": {
                "type": "string"
              },
              "device": {
                "type": "string"
              }
            },
            "required": [ "tracker", "device" ]
          }
        }
      }
    },

    "scene": {
      "type": "object",
      "properties": {
        "offset": { "$ref": "#/$defs/vec3" },
        "orientation": { "$ref": "#/$defs/quat" },
        "scale": { "type": "number" }
      }
    },

    "settings": {
      "type": "object",
      "properties": {
        "depthbuffertexture": { "type": "boolean" },
        "normaltexture": { "type": "boolean" },
        "positiontexture": { "type": "boolean" },
        "precision": {
          "type": "integer",
          "enum": [ 16, 32 ]
        },
        "display": {
          "type": "object",
          "properties": {
            "swapinterval": {
              "type": "integer",
              "minimum": 0
            },
            "refreshrate": {
              "type": "integer",
              "minimum": 0
            }
          }
        }
      }
    },

    "capture": {
      "type": "object",
      "properties": {
        "path": {
          "type": "string"
        },
        "format": {
          "type": "string",
          "enum": [ "png", "PNG", "tga", "TGA", "jpg", "JPG" ]
        },
        "range-begin": {
          "type": "integer"
        },
        "range-end": {
          "type": "integer"
        }
      }
    },

    "device": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "sensors": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "vrpnaddress": {
                "type": "string"
              },
              "id": {
                "type": "integer"
              }
            },
            "required": [ "vrpnaddress", "id" ]
          }
        },
        "buttons": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "vrpnaddress": {
                "type": "string"
              },
              "count": {
                "type": "integer"
              }
            },
            "required": [ "vrpnaddress", "count" ]
          }
        },
        "axes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "vrpnaddress": {
                "type": "string"
              },
              "count": {
                "type": "integer"
              }
            },
            "required": [ "vrpnaddress", "count" ]
          }
        },
        "offset": { "$ref": "#/$defs/vec3" },
        "transformation": { "$ref": "#/$defs/mat4" }
      },
      "required": [ "name" ]
    },

    "tracker": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "devices": {
          "type": "array",
          "items": { "$ref": "#/$defs/device" }
        },
        "offset": { "$ref": "#/$defs/vec3" },
        "orientation": { "$ref": "#/$defs/quat" },
        "matrix": { "$ref": "#/$defs/mat4" },
        "scale": {
          "type": "number"
        }
      },
      "required": [ "name" ]
    }
  }
}
